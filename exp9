

## 1\. üìù IPsec Configuration File (`/etc/ipsec.conf`)

This file defines the overall parameters for the IPsec daemon and the specific connection details for the VPN tunnel.

### File for Peer A ($192.168.1.10$)

```ini
# /etc/ipsec.conf on Peer A (Gateway 1)

config setup
  # Increase debug logging for IKE and Kernel events for troubleshooting
  charondebug="ike 2, knl 2, cfg 2"
  # Disables CRL checks; useful for PSK testing, but use certificates for production
  strictcrlpolicy=no
  # Ensures unique ID per connection
  uniqueids=no
  # Key logging for Wireshark forensics (used in Phase 3 of experiment)
  # keyexchange {
  #   key_log_file = /tmp/ipsec.keys
  # }

# --- Connection Definition for Site-to-Site Tunnel ---
conn net-to-net
  # Connection type is a tunnel
  type=tunnel
  # Use the modern Internet Key Exchange protocol (IKEv2)
  keyexchange=ikev2
  # Automatically start the connection when the service starts
  auto=start
  
  # --- Left Side (Local: Peer A) ---
  # 'left' is the local external IP (dynamic or configured interface)
  left=%defaultroute 
  # Local internal network behind this gateway
  leftsubnet=10.0.1.0/24
  # Identity used for authentication
  leftid=@peerA.vpn
  
  # --- Right Side (Remote: Peer B) ---
  # 'right' is the remote external IP
  right=192.168.1.20
  # Remote internal network behind the other gateway
  rightsubnet=10.0.2.0/24
  # Identity of the remote peer
  rightid=@peerB.vpn
  
  # --- Security Policies (Recommended Modern Settings) ---
  # Phase 1: IKE SA negotiation (Authentication, DH Group)
  # AES-256 GCM, SHA-384, MODP 3072 (stronger than the original AES-CBC example)
  ike=aes256gcm16-sha384-modp3072!
  # Phase 2: ESP SA negotiation (Data encryption)
  # AES-256 GCM authentication and encryption
  esp=aes256gcm16-sha384!
  # Authentication method
  authby=secret
```

-----

### File for Peer B ($192.168.1.20$)

This is the reciprocal configuration, with the `left` and `right` parameters essentially swapped to reflect the local perspective of Peer B.

```ini
# /etc/ipsec.conf on Peer B (Gateway 2)

config setup
  charondebug="ike 2, knl 2, cfg 2"
  strictcrlpolicy=no
  uniqueids=no

# --- Connection Definition for Site-to-Site Tunnel ---
conn net-to-net
  type=tunnel
  keyexchange=ikev2
  auto=start
  
  # --- Left Side (Local: Peer B) ---
  left=%defaultroute 
  leftsubnet=10.0.2.0/24
  leftid=@peerB.vpn
  
  # --- Right Side (Remote: Peer A) ---
  right=192.168.1.10
  rightsubnet=10.0.1.0/24
  rightid=@peerA.vpn
  
  # --- Security Policies (MUST match Peer A's settings exactly) ---
  ike=aes256gcm16-sha384-modp3072!
  esp=aes256gcm16-sha384!
  authby=secret
```

-----

## 2\.  IPsec Secrets File (`/etc/ipsec.secrets`)

This file contains the **Pre-Shared Key (PSK)** used to authenticate the two gateways. This file must be identical on both Peer A and Peer B.

### File for Both Peer A and Peer B

```ini
# /etc/ipsec.secrets on Both Gateways
# Format: <Local ID> <Remote ID> : PSK "shared_secret"

# Defines the PSK for the connection between the two identities
@peerA.vpn @peerB.vpn : PSK "ThisIsAStrongPSKForVPN2025!"

# You can also use explicit IPs if not using identity tags:
# 192.168.1.10 192.168.1.20 : PSK "ThisIsAStrongPSKForVPN2025!"
```
